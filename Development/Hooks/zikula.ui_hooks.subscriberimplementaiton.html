<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <title>Zikula Core</title>
        <link rel="stylesheet" href="https://docs.ziku.la/css/bootstrap.min.css">
        <link rel="stylesheet" href="https://docs.ziku.la/css/font-awesome.min.css">
        <link rel="stylesheet" href="https://docs.ziku.la/css/highlight.tomorrow-night.css">
        <link rel="stylesheet" href="https://docs.ziku.la/css/main.css">

        <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
        <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
        <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
        <link rel="manifest" href="/site.webmanifest">
        <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">
        <meta name="msapplication-TileColor" content="#da532c">
        <meta name="theme-color" content="#ffffff">
    </head>
    <body>
        <header class="navbar fixed-top navbar-dark bg-dark">
            <a class="navbar-brand" href="https://docs.ziku.la/" class="align-items-center">
                <img src="/favicon-32x32.png" alt="Zikula" />
                Zikula Core
                <small class="d-none d-lg-inline">
                    Zikula CMS and Symfony framework
                </small>
            </a>
                            <a href="https://github.com/zikula/core">
                    <img style="position: absolute; top: 0; right: 0; border: 0;" src="https://docs.ziku.la/images/fork.png" alt="Fork me on GitHub" />
                </a>
                    </header>
        <main class="container-fluid">
            <div class="row">
                                    <nav id="sidebar" class="col-md-3 col-xl-2" role="navigation">
                                                    <p class="text-muted">
                                <a href="#section1" data-toggle="collapse">
                                    General
                                </a>
                            </p>
                            <ul id="section1" class="nav flex-column collapse show">
                                                                    <li class="nav-item">
                                        <a href="https://docs.ziku.la/index.html" class="nav-link">
                                            About
                                        </a>
                                    </li>
                                                                    <li class="nav-item">
                                        <a href="https://docs.ziku.la/General/Contributing/index.html" class="nav-link">
                                            Contributing
                                        </a>
                                    </li>
                                                                    <li class="nav-item">
                                        <a href="https://docs.ziku.la/General/Releases/index.html" class="nav-link">
                                            Roadmap and Releases
                                        </a>
                                    </li>
                                                                    <li class="nav-item">
                                        <a href="https://docs.ziku.la/General/vendorinformation.html" class="nav-link">
                                            Vendor information
                                        </a>
                                    </li>
                                                            </ul>
                                                    <p class="text-muted">
                                <a href="#section2" data-toggle="collapse">
                                    Setup
                                </a>
                            </p>
                            <ul id="section2" class="nav flex-column collapse">
                                                                    <li class="nav-item">
                                        <a href="https://docs.ziku.la/Setup/requirements.html" class="nav-link">
                                            Requirements
                                        </a>
                                    </li>
                                                                    <li class="nav-item">
                                        <a href="https://docs.ziku.la/Setup/installation.html" class="nav-link">
                                            Installation
                                        </a>
                                    </li>
                                                                    <li class="nav-item">
                                        <a href="https://docs.ziku.la/Setup/upgrade.html" class="nav-link">
                                            Upgrade
                                        </a>
                                    </li>
                                                            </ul>
                                                    <p class="text-muted">
                                <a href="#section3" data-toggle="collapse">
                                    Configuration
                                </a>
                            </p>
                            <ul id="section3" class="nav flex-column collapse">
                                                                    <li class="nav-item">
                                        <a href="https://docs.ziku.la/Configuration/Settings/index.html" class="nav-link">
                                            Main settings
                                        </a>
                                    </li>
                                                                    <li class="nav-item">
                                        <a href="https://docs.ziku.la/Configuration/Localisation/index.html" class="nav-link">
                                            Localisation
                                        </a>
                                    </li>
                                                                    <li class="nav-item">
                                        <a href="https://docs.ziku.la/Configuration/Mailer/index.html" class="nav-link">
                                            Mailer
                                        </a>
                                    </li>
                                                                    <li class="nav-item">
                                        <a href="https://docs.ziku.la/Configuration/AdminPanel/index.html" class="nav-link">
                                            Admin panel
                                        </a>
                                    </li>
                                                                    <li class="nav-item">
                                        <a href="https://docs.ziku.la/Configuration/Security/index.html" class="nav-link">
                                            Security center
                                        </a>
                                    </li>
                                                                    <li class="nav-item">
                                        <a href="https://docs.ziku.la/Configuration/Extensions/index.html" class="nav-link">
                                            Extensions
                                        </a>
                                    </li>
                                                                    <li class="nav-item">
                                        <a href="https://docs.ziku.la/Configuration/Routes/index.html" class="nav-link">
                                            Routes
                                        </a>
                                    </li>
                                                                    <li class="nav-item">
                                        <a href="https://docs.ziku.la/Configuration/Workflows/index.html" class="nav-link">
                                            Workflows
                                        </a>
                                    </li>
                                                            </ul>
                                                    <p class="text-muted">
                                <a href="#section4" data-toggle="collapse">
                                    Access Control
                                </a>
                            </p>
                            <ul id="section4" class="nav flex-column collapse">
                                                                    <li class="nav-item">
                                        <a href="https://docs.ziku.la/AccessControl/groups.html" class="nav-link">
                                            Groups
                                        </a>
                                    </li>
                                                                    <li class="nav-item">
                                        <a href="https://docs.ziku.la/AccessControl/users.html" class="nav-link">
                                            Users
                                        </a>
                                    </li>
                                                                    <li class="nav-item">
                                        <a href="https://docs.ziku.la/AccessControl/authentication.html" class="nav-link">
                                            Authentication
                                        </a>
                                    </li>
                                                                    <li class="nav-item">
                                        <a href="https://docs.ziku.la/AccessControl/permissions.html" class="nav-link">
                                            Permissions
                                        </a>
                                    </li>
                                                            </ul>
                                                    <p class="text-muted">
                                <a href="#section5" data-toggle="collapse">
                                    Layout &amp; Design
                                </a>
                            </p>
                            <ul id="section5" class="nav flex-column collapse">
                                                                    <li class="nav-item">
                                        <a href="https://docs.ziku.la/LayoutDesign/Templating/index.html" class="nav-link">
                                            Templating
                                        </a>
                                    </li>
                                                                    <li class="nav-item">
                                        <a href="https://docs.ziku.la/LayoutDesign/Themes/index.html" class="nav-link">
                                            Themes
                                        </a>
                                    </li>
                                                                    <li class="nav-item">
                                        <a href="https://docs.ziku.la/LayoutDesign/Blocks/index.html" class="nav-link">
                                            Blocks
                                        </a>
                                    </li>
                                                                    <li class="nav-item">
                                        <a href="https://docs.ziku.la/LayoutDesign/Menus/index.html" class="nav-link">
                                            Menus
                                        </a>
                                    </li>
                                                                    <li class="nav-item">
                                        <a href="https://docs.ziku.la/LayoutDesign/Forms/index.html" class="nav-link">
                                            Forms
                                        </a>
                                    </li>
                                                            </ul>
                                                    <p class="text-muted">
                                <a href="#section6" data-toggle="collapse">
                                    Translation
                                </a>
                            </p>
                            <ul id="section6" class="nav flex-column collapse">
                                                                    <li class="nav-item">
                                        <a href="https://docs.ziku.la/Translation/index.html" class="nav-link">
                                            Overview
                                        </a>
                                    </li>
                                                            </ul>
                                                    <p class="text-muted">
                                <a href="#section7" data-toggle="collapse">
                                    Integration
                                </a>
                            </p>
                            <ul id="section7" class="nav flex-column collapse">
                                                                    <li class="nav-item">
                                        <a href="https://docs.ziku.la/Integration/Categories/index.html" class="nav-link">
                                            Categories
                                        </a>
                                    </li>
                                                                    <li class="nav-item">
                                        <a href="https://docs.ziku.la/Integration/Search/index.html" class="nav-link">
                                            Search
                                        </a>
                                    </li>
                                                            </ul>
                                                    <p class="text-muted">
                                <a href="#section8" data-toggle="collapse">
                                    Extensions
                                </a>
                            </p>
                            <ul id="section8" class="nav flex-column collapse">
                                                                    <li class="nav-item">
                                        <a href="https://docs.ziku.la/Extensions/content.html" class="nav-link">
                                            Content
                                        </a>
                                    </li>
                                                                    <li class="nav-item">
                                        <a href="https://docs.ziku.la/Extensions/other.html" class="nav-link">
                                            Other
                                        </a>
                                    </li>
                                                            </ul>
                                                    <p class="text-muted">
                                <a href="#section9" data-toggle="collapse">
                                    Extension Development
                                </a>
                            </p>
                            <ul id="section9" class="nav flex-column collapse">
                                                                    <li class="nav-item">
                                        <a href="https://docs.ziku.la/Development/General/index.html" class="nav-link">
                                            General
                                        </a>
                                    </li>
                                                                    <li class="nav-item">
                                        <a href="https://docs.ziku.la/Development/Doctrine/index.html" class="nav-link">
                                            Databases & Doctrine
                                        </a>
                                    </li>
                                                                    <li class="nav-item">
                                        <a href="https://docs.ziku.la/Development/Extensions/index.html" class="nav-link">
                                            Extension services
                                        </a>
                                    </li>
                                                                    <li class="nav-item">
                                        <a href="https://docs.ziku.la/Development/Hooks/index.html" class="nav-link active">
                                            Hooks
                                        </a>
                                    </li>
                                                                    <li class="nav-item">
                                        <a href="https://docs.ziku.la/Development/Misc/index.html" class="nav-link">
                                            Misc
                                        </a>
                                    </li>
                                                                    <li class="nav-item">
                                        <a href="https://modulestudio.de/en/documentation/10-introduction/" class="nav-link">
                                            Model-driven approach
                                        </a>
                                    </li>
                                                            </ul>
                                                    <p class="text-muted">
                                <a href="#section10" data-toggle="collapse">
                                    Resources
                                </a>
                            </p>
                            <ul id="section10" class="nav flex-column collapse">
                                                                    <li class="nav-item">
                                        <a href="https://ziku.la" class="nav-link">
                                            Zikula website
                                        </a>
                                    </li>
                                                                    <li class="nav-item">
                                        <a href="https://github.com/zikula/core" class="nav-link">
                                            <i class="fab fa-github"></i> GitHub
                                        </a>
                                    </li>
                                                                    <li class="nav-item">
                                        <a href="https://joinslack.ziku.la/" class="nav-link">
                                            <i class="fab fa-slack"></i> Slack
                                        </a>
                                    </li>
                                                            </ul>
                                            </nav>
                                <section class="offset-md-3 offset-xl-2 col-md-9 col-xl-10">
                    <h1 id="subscriber-workflow-for-display-hooks">Subscriber workflow for display hooks</h1>
<h2 id="introduction-to-neweditdelete-types-subscriber-implementation">Introduction to new/edit/delete types subscriber Implementation</h2>
<p>The next two hook types, 'creating new items' and 'editing existing items' are considered to be
all part of the same workflow.  There is little point duplicating the bulk of code required
to process create and edit, therefore we should combine them into a single controller and view.
This is because whether creating a new item, or editing an existing item, we're using
essentially the same form.  In 'create' the form starts out empty, and in 'edit' the form
is populated by a database query.  We know if we should validate and commit any input data
if the form was submitted or not.  And lastly, when we process the form on submit, again,
it's the same process that is used to update, the only difference is we might use an
<code>persist($entity)</code> as well as <code>flush()</code>.  This is why we can use one controller method and view
for both create and edit actions.</p>
<p>For this reason also, there is no need for separate display and processing methods.  For example
<code>edit()</code> to display edit form, and <code>update()</code> to validate and update the record, followed by a
redirect simply do not make sense when it can be done easily in one controller method.</p>
<h3 id="creating-a-new-item">Creating a new item</h3>
<p>When we create an item, essentially, we visit an edit page with no id in the request.
From this we know that the action is not an edit, but a 'create new'.  We can determine
if it's a brand new form or a submitted form by reading the form submit property.
Accordingly, we can notify the system of the hook events.</p>
<p>When displaying a new empty form, we simply trigger a <code>form_edit</code> in the template with
<code>{{ notifydisplayhooks }}</code> using a null id.</p>
<pre><code class="language-twig">{{ notifyDisplayHooks('foo.ui_hooks.form_edit', null) }}</code></pre>
<p>The function will return all display hook handlers that respond, sorted according to
the administration settings. By default, the return is a string.</p>
<p>When we come to validate a new create form, this means we have received a submit command
in the form.  We can then validate our form and then trigger a <code>validate_edit</code> hook with</p>
<pre><code class="language-php">$hook = new \Zikula\Bundle\HookBundle\Hook\ValidationHook(new \Zikula\Bundle\HookBundle\Hook\ValidationProviders());
$this-&gt;dispatchHooks('…validate_edit', $hook);
$validators = $hook-&gt;getValidators();</code></pre>
<p>The validator collection can then be tested for the presence of validation errors or not
with <code>$validators-&gt;hasErrors()</code>.  Together with the form submit the method can decide
if it's safe to commit the data to the database or, if the form needs to be redisplayed with
validation errors.</p>
<p>If it's ok simply commit the form data, then trigger a <code>process_edit</code> Zikula_ProcessHook with</p>
<pre><code class="language-php">new \Zikula\Bundle\HookBundle\Hook\ProcessHook($name, $id, $url);</code></pre>
<p>The URL should be an instance of <code>Zikula\Bundle\CoreBundle\UrlInterface</code> which describes how to get the newly created object.
For this reason you must determine the ID of the object before you issue a <code>Zikula\Bundle\HookBundle\Hook\ProcessHook</code>.</p>
<p>If the data is not ok, then redisplay the template.</p>
<p><code>form_edit</code> hooks are displayed in the template with</p>
<pre><code class="language-twig">{{ notifyDisplayHooks('foo.ui_hooks.form_edit', id) }}</code></pre>
<h3 id="editing-an-existing-item">Editing an existing item</h3>
<p>When when we edit an item, we visit an edit page with an id in the request and the
controller will retrieve the item to be edited from the database.</p>
<p>We can determine if we should validate and commit the item or just display the item for
editing by reading the form submit property.
Accordingly, we can notify the system of the hook events.</p>
<p>When displaying an edit form, we simply trigger a <code>form_edit</code> hook with with</p>
<pre><code class="language-twig">{{ notifyDisplayHooks('&lt;module&gt;.ui_hooks.&lt;area&gt;.form_edit', id) }}</code></pre>
<p>When we come to validate an edit form, this means we have received a submit command
in the form.  We can then validate our form and then trigger a <code>validate_edit</code> event with</p>
<pre><code class="language-php">$hook = new \Zikula\Bundle\HookBundle\Hook\ValidationHook(new Zikula_Hook_ValidationProviders());
$this-&gt;DispatchHooks('…validate_edit', $hook);
$validators = $hook-&gt;getValidators();</code></pre>
<p>The validator collection can then be tested for the presence of validation errors or not
with <code>$validators-&gt;hasErrors()</code>.  Together with the form submit the method can decide
if it's safe to commit the data to the database or, if the form needs to be redisplayed with
validation errors.</p>
<p>If it's ok simply commit the form data, then trigger a <code>process_edit</code> event with</p>
<pre><code class="language-php">new \Zikula\Bundle\HookBundle\Hook\ProcessHook($name, $id, $url);</code></pre>
<p>If the data is not ok, then simply redisplay the template.  The triggered event will pick up
the validation problems automatically as the validation of each handler will persist in
the <code>Zikula\Bundle\HookBundle\Hook\AbstractHookListener</code> instances unless using an outdated workflow where the
validation method redirects to display methods, in which case you will have to do validation again.</p>
<p><code>form_edit</code> hooks are displayed in the template with</p>
<pre><code class="language-twig">{{ notifyDisplayHooks('&lt;module&gt;.ui_hooks.&lt;area&gt;.form_edit', id) }}</code></pre>
<h3 id="deleting-an-item">Deleting an item</h3>
<p>There are many different approaches that can be taken to deleting an item. For example we
can add a delete button to an edit form.  We usually would have a confirmation screen
or we might just use a javascript confirmation.  Generally, we would not want to add
anything extra to a delete confirmation page, but we certainly need to process a delete
action.  Ultimately when a controller (that makes use of hooks) deletes an item, it
must notify the attached modules to prevent orphaned records.  This is done simply by
triggering a hookable event with</p>
<pre><code class="language-php">new \Zikula\Bundle\HookBundle\Hook\ProcessHook($name, $id, $url);</code></pre>
<p><code>form_delete</code> hooks are displayed in the template with</p>
<pre><code class="language-twig">{{ notifyDisplayHooks('&lt;module&gt;.ui_hooks.&lt;area&gt;.form_delete', id) }}</code></pre>
<h3 id="optionally-managing-display-of-hooks">Optionally managing display of hooks</h3>
<p>In most situations, it is fine to display hooks as they have been loaded by the providers. e.g.</p>
<pre><code class="language-twig">{{ notifyDisplayHooks('&lt;module&gt;.ui_hooks.&lt;area&gt;.form_edit', id) }}</code></pre>
<p>This is because the order the hooks are displayed in can be controlled by the Hook UI via drag and drop.</p>
<p>But if a subscriber must exert more fine-grained control over the display of hooks, this can be done by passing
the fourth argument as <code>true</code> and then assigning the hooks to a variable like so:</p>
<pre><code class="language-twig">{% set hooks = notifyDisplayHooks('&lt;module&gt;.ui_hooks.&lt;area&gt;.form_edit', id, null, true) %}</code></pre>
<p>Then the subscriber template must loop that variable and display each hook:</p>
<pre><code class="language-twig">{% for area, hook in hooks %}
    &lt;div class="z-displayhook my-special-hook-class" data-area="{{ area }}"&gt;{{ hook|raw }}&lt;/div&gt;
{% endfor %}</code></pre>
                </section>
            </div>
        </main>
        <script src="https://docs.ziku.la/js/jquery.min.js"></script>
        <script src="https://docs.ziku.la/js/bootstrap.bundle.min.js"></script>
        <script src="https://docs.ziku.la/js/highlight.pack.js"></script>
        <script src="https://docs.ziku.la/js/site.js"></script>
    </body>
</html>
