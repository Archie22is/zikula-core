parameters:
    zikula_core.internal.token.max_life: 3600

services:
    zikula_core.common.markdown_parser:
        class: Michelf\MarkdownExtra

    zikula_core.common.markdown_extra_parser:
        class: Michelf\MarkdownExtra

    zikula_core.internal.token.storage:
        class: Zikula\Core\Token\Storage\SessionStorage
        arguments: ["@session"]

    zikula_core.internal.token.generator:
        class: Zikula\Core\Token\Generator
        arguments: ["@zikula_core.internal.token.storage", "_dummy", "%zikula_core.internal.token.max_life%"]

    zikula_core.internal.token.validator:
        class: Zikula\Core\Token\Validator
        arguments: ["@zikula_core.internal.token.generator"]

    zikula_core.common.csrf_token_handler:
        class: Zikula\Core\Token\CsrfTokenHandler
        arguments:
          - "@zikula_core.internal.token.generator"
          - "@zikula_core.internal.token.validator"
          - "@request_stack"
          - "@zikula_extensions_module.api.variable"
          - "@session"

    zikula_core.internal.doctrine_listener:
        class: Zikula\Bundle\CoreBundle\EventListener\DoctrineListener
        arguments:
          - '@doctrine.orm.default_entity_manager'
          - '@doctrine.annotation_driver'
        tags:
            - { name: kernel.event_subscriber }

    zikula_core.internal.clickjack_protection_listener:
        class: Zikula\Bundle\CoreBundle\EventListener\ClickjackProtectionListener
        arguments: ["%security.x_frame_options%"]
        tags:
            - { name: kernel.event_subscriber }

    zikula_core.internal.site_off_listener:
        class: Zikula\Bundle\CoreBundle\EventListener\SiteOffListener
        arguments:
          - "@zikula_extensions_module.api.variable"
          - "@zikula_permissions_module.api.permission"
          - "@zikula_users_module.current_user"
          - "@twig"
          - "@form.factory"
          - "@router"
          - "%installed%"
          - "@=container.hasParameter('core_installed_version') ? parameter('core_installed_version') : ''"
        tags:
            - { name: kernel.event_subscriber }

    zikula_core.internal.session_expire_listener:
        class: Zikula\Bundle\CoreBundle\EventListener\SessionExpireListener
        arguments: ["%installed%"]
        tags:
            - { name: kernel.event_subscriber }

    zikula_core.internal.exception_listener:
        class: Zikula\Bundle\CoreBundle\EventListener\ExceptionListener
        arguments:
          - "@router"
          - "@event_dispatcher"
          - "@zikula.cache_clearer"
          - "@zikula_users_module.current_user"
          - "%installed%"
        tags:
            - { name: kernel.event_subscriber }
            - { name: monolog.logger, channel: request }

    zikula_core.internal.output_compression_listener:
        class: Zikula\Bundle\CoreBundle\EventListener\OutputCompressionListener
        arguments: ["@zikula_extensions_module.api.variable", "%installed%"]
        tags:
            - { name: kernel.event_subscriber }

    zikula_core.internal.strip_front_controller_listener:
        class: Zikula\Bundle\CoreBundle\EventListener\StripFrontControllerListener
        arguments: ["@zikula_extensions_module.api.variable", "%installed%"]
        tags:
            - { name: kernel.event_subscriber }

    zikula_core.common.doctrine.schema_tool:
        class: Zikula\Core\Doctrine\Helper\SchemaHelper
        lazy: true
        arguments: ["@doctrine.orm.default_entity_manager"]

    zikula_core.internal.bootstrap_helper:
        class: Zikula\Bundle\CoreBundle\Bundle\Helper\BootstrapHelper
        arguments: ["@doctrine.dbal.default_connection", "@zikula.cache_clearer"]
